Schema Reference
================

This is an automatically generated documentation page from the HSDS Example Profile. You should edit this introduction appropriately. You can also edit how this page displays your Profile schemas to make it more friendly for your implementors and data users.

## How this page is generated

This page is designed to provide a canonical *Schema Reference* page for your Profile, with a reference table for each schema ("object" or "table") in your Profile. It's a good idea to keep this page lightweight and to the point, so that it's a clean reference for people to refer to when implementing your Profile or using data that conforms to your Profile.

This page is initially generated by calling the script located in `python/generate_schema_reference_page.py`. This does the following:

1. Looks inside the `schema/` directory for your Profile schema files. *This requires that you have already run the HSDS Tools to generate your Profile schemas!*
2. Opens this file (`docs/schema_reference.md`)
3. Looks for the line containing `{{insert_schema_reference_tables}}`
4. Replaces the above line with the following, for *each* of the detected schema files inside of `schema/`:
  * a H3-level heading (sub-sub-heading) in Markdown format, labelled after the schema name e.g. `### service`
  * A sphinx directive designed to draw a *basic* reference table for the schema

It should be safe to write content either side of the line containing `{{insert_schema_reference_tables}}`, as the script will ignore all other liness in this file. You MUST ensure that `{{insert_schema_reference_tables}}` is on its own line, with nothing else on that line otherwise the script will not match it.

This is designed to get you started, but you may want to take things a step further by editing the Sphinx directives manually to provide some more features. This is covered in the next section:

### Manually editing this page

You are encouraged to manually edit this page to provide a good reference page for your HSDS Profile Schema. The `generate_schema_reference_page.py` script is really only designed to get you started and provide a minimal base Schema Reference Page for teams without the resources to commit to documenting a Profile by hand. Long-term, you know your Profile much better than any scrip and your users will benefit from the tailored approach to your Profile documentation. You can even skip using the script and generate your page manually if you feel that is best.

Some things you might want to do are:

* Providing Examples in another Tab
* Provide a brief summary or normative information about the schema between the sub-sub-section header and the reference table.
* Using the Compiled Schema to draw the table, rather than the base schema. This requires some further tweaking and is probably the most involved step.

#### Providing examples in another tab

You may want to include examples for each schema, to help people understand how the schema looks when used in practice.

The HSDS schema tools automatically generates examples for your Profile based on the examples present in the [HSDS Specification repository](https://github.com/openreferral/specification/tree/3.0/examples) and removing properties which are not present in your Profile schema. If your Profile adds some more Properties or new Schemas, then you will likely need to generate your own examples for these or amend the automatically generated ones.

If you read the [HSDS Schema reference Page](http://docs.openreferral.org/en/latest/hsds/schema_reference.html#objects-and-fields) you will see that the schema reference tables also have some additional tabs containing some examples, as well the schema itself. We're just going to be focusing on the Examples tab, but you can apply the same process to include a schema tab.

This works by wrapping the reference table in a tabset and having a different tab for the field reference and the examples. On the assumption that you have run `generate_schema_reference_page.py`, you might have something like the following in this file:

````
### service

```{jsonschema} ../schema/service.json
```
````

Let's wrap that in a tab set:

````

::::{tab-set}

:::{tab-item} Fields <-- name of the tab
```{jsonschema} ../schema/service.json <-- a sphinx directive or text for the tab's contents
```
:::

::::

````

That gets us a tabset with one item in it. Now let's add another tab pointing to our example:

````
::::{tab-set}

:::{tab-item} Fields
```{jsonschema} ../schema/service.json
```
:::

:::{tab-item} Example
```{eval-rst}
.. jsoninclude:: ../examples/service_full.json
    :jsonpointer:
    :title: service
```
:::

::::

````
The second tab contains a sphinx directive to include the JSON located in our example file, and a pointer creating a dropdown menu with the title 'service'. This would allow us to create several examples in the same tab, if necessary.

#### Providing a brief summary between the heading and the reference table

Let's assume you've run the `generate_schema_reference_page.py` script and have something like the following:

````
### service

```{jsonschema} ../schema/service.json
```
````

You can simply write what you want between the heading and the directive:

````
### service

Lorem ipsum! Write something about services here

```{jsonschema} ../schema/service.json
```
````

Or you can use the definition provided in the schema file's `description` field, to automatically populate it:

````
### service

`service` is defined as:

```{jsoninclude-quote} ../schema/service.json
:jsonpointer: /description
```

Each `service` object has the following fields:

```{jsonschema} ../schema/service.json
```
````

This will automatically reference the content in the `service.json` schema file. You can combine the two approaches, but you should be aware that a Schema Reference Page is designed to contain only normative content. It should not be used for non-normative guidance.

#### Using the compiled schema to draw the Reference Table

The reference tables on the [HSDS Schema Reference Page](http://docs.openreferral.org/en/latest/hsds/schema_reference.html#objects-and-fields) each use the compiled schemas inside `schema/compiled/` rather than the base schemas inside `schema/`. This is because the compiled schemas are completely dereferenced and also have the descriptions amended slightly to allow linking between difference reference tables quickly as opposed to the JSON version of the schema.

It would be great if `generate_schema_reference_page.py` was able to automatically generate reference tables for your Profile which used the Compiled schemas, but the fact that Profiles may remove portions of the schema and introduce new objects and fields means that this may be more suited to a more manual touch.

The challenge stems from the fact that the compiled schema is dereferenced, so an entire copy of each linked object is inserted at the appropriate place. This is great for validation tooling, but not so good for documentation because it leads to a lot of repetition and very large reference tables. This might be confusing or unfriendly, as well as being inherently unwieldy.

In HSDS, the schema reference tables "collapse" certain fields in the reference table for this very reason. This allows the reference tables to make use of the features of the compiled schemas without repeating details from other tables. These collapsed fields must be explicitly declared in the Sphinx directive to generate the table e.g.:

````
```{jsonschema} ../schema/compiled/service_with_definitions.json
:collapse: phones,schedules,service_areas,service_at_locations,languages,organization,funding,cost_options,program,required_documents,contacts,attributes,metadata
```
````
This becomes difficult to automatically generate in a script because a Profile may make arbitrary changes such as removing schemas. This Example Profile removes `Metadata`, so the above line will throw an error when trying to generate the table.

If you wish to generate your reference tables using the compiled schemas available under `schema/compiled`, then you should do so manually.

## Objects and fields

If you run `python/generate_schema_reference_page.py`, then this section will contain a reference table for each schema file in your Profile. The script is very naÃ¯ve, and will insert each reference table in whatever order it reads the files from &ndash; you likely want to change the order once you've run the script!

### attribute

```{jsonschema} ../schema/attribute.json
```
### meta_table_description

```{jsonschema} ../schema/meta_table_description.json
```
### taxonomy

```{jsonschema} ../schema/taxonomy.json
```
### taxonomy_term

```{jsonschema} ../schema/taxonomy_term.json
```
### accessibility

```{jsonschema} ../schema/accessibility.json
```
### address

```{jsonschema} ../schema/address.json
```
### contact

```{jsonschema} ../schema/contact.json
```
### language

```{jsonschema} ../schema/language.json
```
### location

```{jsonschema} ../schema/location.json
```
### organization

```{jsonschema} ../schema/organization.json
```
### phone

```{jsonschema} ../schema/phone.json
```
### required_document

```{jsonschema} ../schema/required_document.json
```
### schedule

```{jsonschema} ../schema/schedule.json
```
### service

```{jsonschema} ../schema/service.json
```
### service_at_location

```{jsonschema} ../schema/service_at_location.json
```
